# PulseWeave API Gateway å·¥ä½œæµç¨‹è¯¦è§£

## ðŸŽ¯ é¡¹ç›®å®šä½

PulseWeaveæ˜¯ä¸€ä¸ª**åŸºäºŽè¯­éŸ³çš„æ™ºèƒ½å¤‡å¿˜å’Œå»ºè®®å·¥å…·**ï¼ŒAPI Gatewayæ˜¯å…¶æ ¸å¿ƒæŽ¨ç†æœåŠ¡ï¼Œè´Ÿè´£ï¼š
- æŽ¥æ”¶è¯­éŸ³è½¬å†™æ–‡æœ¬æˆ–å®Œæ•´äº‹ä»¶æ•°æ®
- ä½¿ç”¨DeepSeek AIè¿›è¡Œæ™ºèƒ½åˆ†æž
- æä¾›ä»»åŠ¡åˆ†ç±»ã€é—æ¼æ£€æµ‹ã€è¡ŒåŠ¨å»ºè®®ç­‰åŠŸèƒ½

## ðŸ“Š æ•°æ®æµç¨‹å›¾

```
è¯­éŸ³è®¾å¤‡/åº”ç”¨ â†’ ASRè½¬å†™ â†’ äº‹ä»¶æ•°æ® â†’ API Gateway â†’ DeepSeek AI â†’ æ™ºèƒ½åˆ†æžç»“æžœ
     â†“              â†“         â†“           â†“            â†“           â†“
   å½•éŸ³æ–‡ä»¶      è½¬å†™æ–‡æœ¬    JSONäº‹ä»¶    æŽ¨ç†è¯·æ±‚     AIåˆ†æž     å¢žå¼ºç»“æžœ
```

## ðŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### ç¬¬1æ­¥ï¼šæ•°æ®è¾“å…¥
**ä¸¤ç§è¾“å…¥æ¨¡å¼**ï¼š

#### æ¨¡å¼Aï¼šç®€å•æ–‡æœ¬ï¼ˆé€‚åˆå¿«é€Ÿæµ‹è¯•ï¼‰
```json
{
  "text": "æ˜Žæ—©ä¸ƒç‚¹åŽ»æœºåœºï¼Œè®°å¾—èº«ä»½è¯å’Œå……ç”µå®"
}
```

#### æ¨¡å¼Bï¼šå®Œæ•´äº‹ä»¶æ•°æ®ï¼ˆç”Ÿäº§çŽ¯å¢ƒæŽ¨èï¼‰
```json
{
  "event": {
    "event_id": "evt_20250901_090005_0001",
    "transcript": "æ˜Žæ—©ä¸ƒç‚¹åŽ»æœºåœºï¼Œè®°å¾—èº«ä»½è¯å’Œå……ç”µå®",
    "speakers": [...],
    "audio_features": {...},
    "entities": [...],
    // å®Œæ•´çš„è¯­éŸ³äº‹ä»¶ç»“æž„
  }
}
```

### ç¬¬2æ­¥ï¼šæ–‡æœ¬æå–
API Gatewayä¼šè‡ªåŠ¨æå–è¦åˆ†æžçš„æ–‡æœ¬ï¼š
- å¦‚æžœæœ‰`text`å­—æ®µ â†’ ç›´æŽ¥ä½¿ç”¨
- å¦‚æžœåªæœ‰`event.transcript` â†’ ä½¿ç”¨transcript
- å¦‚æžœéƒ½æ²¡æœ‰ â†’ è¿”å›ž422é”™è¯¯

### ç¬¬3æ­¥ï¼šDeepSeek AIåˆ†æž
ä½¿ç”¨ä¼˜åŒ–çš„promptè°ƒç”¨DeepSeek APIï¼š
```
ç³»ç»Ÿè§’è‰²ï¼šè´´å¿ƒçš„AIç”Ÿæ´»åŠ©ç†
ç”¨æˆ·è¾“å…¥ï¼šè¦åˆ†æžçš„æ–‡æœ¬
åˆ†æžè¦æ±‚ï¼š
- è¯†åˆ«ä»»åŠ¡ç±»åž‹ï¼ˆ10ç§é¢„å®šä¹‰ç±»åž‹ï¼‰
- è¯„ä¼°ç½®ä¿¡åº¦
- æ£€æµ‹å¯èƒ½é—æ¼çš„ä¿¡æ¯
- ç”Ÿæˆäººæ€§åŒ–æ‘˜è¦
- æä¾›å®žç”¨çš„è¡ŒåŠ¨å»ºè®®
```

### ç¬¬4æ­¥ï¼šç»“æžœå¢žå¼º
å¦‚æžœè¾“å…¥åŒ…å«äº‹ä»¶æ•°æ®ï¼Œä¼šè¿›è¡Œé¢å¤–åˆ†æžï¼š

#### 4.1 å®žä½“æå–
ä»Žäº‹ä»¶æ•°æ®ä¸­æå–å·²è¯†åˆ«çš„å®žä½“ï¼š
```json
"extracted_entities": [
  {"type": "time", "value": "æ˜Žæ—©ä¸ƒç‚¹", "confidence": 0.9},
  {"type": "place", "value": "æœºåœº", "confidence": 0.95}
]
```

#### 4.2 æ ‡ç­¾å»ºè®®
åŸºäºŽä»»åŠ¡ç±»åž‹å’ŒçŽ°æœ‰æ ‡ç­¾ç”Ÿæˆå»ºè®®ï¼š
```json
"suggested_tags": ["trip", "travel", "planning"]
```

#### 4.3 ä¼˜å…ˆçº§è¯„ä¼°
åŸºäºŽAIç½®ä¿¡åº¦è‡ªåŠ¨è¯„ä¼°ï¼š
- confidence > 0.8 â†’ "high"
- confidence 0.4-0.8 â†’ "medium"  
- confidence < 0.4 â†’ "low"

#### 4.4 æé†’ç”Ÿæˆ
åŸºäºŽé—æ¼é¡¹ç”Ÿæˆå…·ä½“æé†’ï¼š
```json
"reminder_suggestions": ["è®°å¾—ç¡®è®¤è¡ŒæŽ", "è®°å¾—ç¡®è®¤äº¤é€šå·¥å…·"]
```

#### 4.5 äº‹ä»¶åˆ†æž
åˆ†æžäº‹ä»¶çš„åŸºæœ¬ç‰¹å¾ï¼š
```json
"event_analysis": {
  "speaker_count": 1,
  "event_duration_sec": 97.0,
  "contains_pii": false,
  "has_audio_features": true
}
```

#### 4.6 è¯´è¯äººæ´žå¯Ÿ
åˆ†æžå¤šè¯´è¯äººåœºæ™¯ï¼š
```json
"speaker_insights": {
  "total_speakers": 1,
  "user_speakers": 1,
  "multi_speaker": false,
  "primary_speaker": "SPK_1"
}
```

#### 4.7 éŸ³é¢‘è´¨é‡è¯„ä¼°
è¯„ä¼°ASRè´¨é‡ï¼š
```json
"audio_quality_assessment": {
  "overall_quality": "good",
  "asr_confidence": 0.87,
  "snr_db": 20.5
}
```

### ç¬¬5æ­¥ï¼šç»“æžœè¿”å›ž
è¿”å›žå®Œæ•´çš„åˆ†æžç»“æžœï¼ŒåŒ…å«ï¼š
- åŸºç¡€æŽ¨ç†ç»“æžœï¼ˆå‘åŽå…¼å®¹ï¼‰
- å¢žå¼ºåˆ†æžç»“æžœï¼ˆä»…å½“æœ‰äº‹ä»¶æ•°æ®æ—¶ï¼‰

## ðŸ—ï¸ ç³»ç»Ÿæž¶æž„

### æ ¸å¿ƒç»„ä»¶

1. **FastAPIæœåŠ¡å™¨** (`server.py`)
   - æŽ¥æ”¶HTTPè¯·æ±‚
   - å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
   - è°ƒç”¨æŽ¨ç†æœåŠ¡

2. **DeepSeek Provider** (`providers/deepseek_provider.py`)
   - å°è£…DeepSeek APIè°ƒç”¨
   - å¤„ç†è¶…æ—¶å’Œé‡è¯•
   - æä¾›å¤‡ç”¨è§„åˆ™å¼•æ“Ž

3. **æ•°æ®æ¨¡åž‹** (`schemas.py`)
   - å®šä¹‰å®Œæ•´çš„äº‹ä»¶æ•°æ®ç»“æž„
   - è¯·æ±‚/å“åº”éªŒè¯
   - ç±»åž‹å®‰å…¨ä¿è¯

4. **Promptæ¨¡æ¿** (`prompt_templates.py`)
   - ä¼˜åŒ–çš„AIæç¤ºè¯
   - ä»»åŠ¡ç±»åž‹å®šä¹‰
   - é—æ¼æ£€æµ‹è§„åˆ™

### é…ç½®æ–‡ä»¶ (`config.yaml`)
```yaml
provider:
  name: deepseek
  mode: http
  base_url: https://api.deepseek.com
  model: deepseek-chat
  api_key: your-api-key
  timeout_sec: 30
  temperature: 0.0
  max_tokens: 300

service:
  require_auth: false
  return_vector: false
```

## ðŸŽ¨ å‰ç«¯ç•Œé¢

### åŸºç¡€ç•Œé¢ (`static/index.html`)
- ç®€å•çš„æ–‡æœ¬è¾“å…¥æµ‹è¯•
- ç»“æžœå±•ç¤ºå’Œè°ƒè¯•
- å¢žå¼ºä¿¡æ¯å¯è§†åŒ–

### é«˜çº§ç•Œé¢ (`static/advanced_demo.html`)
- å¤šæ ‡ç­¾é¡µè®¾è®¡
- å®žæ—¶æŽ¨ç†æµ‹è¯•
- é…ç½®ç®¡ç†

## ðŸ”§ éƒ¨ç½²å’Œä½¿ç”¨

### å¯åŠ¨æœåŠ¡
```bash
cd api_gateway
python start_server.py --reload
```

### è®¿é—®ç•Œé¢
- åŸºç¡€ç•Œé¢: http://localhost:8000/ui/
- APIæ–‡æ¡£: http://localhost:8000/docs
- å¥åº·æ£€æŸ¥: http://localhost:8000/health

### APIè°ƒç”¨ç¤ºä¾‹
```python
import httpx

# ç®€å•æ–‡æœ¬æŽ¨ç†
response = httpx.post("http://localhost:8000/infer", 
                     json={"text": "æ˜Žå¤©å¼€ä¼šè®°å¾—å¸¦èµ„æ–™"})

# å®Œæ•´äº‹ä»¶æ•°æ®æŽ¨ç†
response = httpx.post("http://localhost:8000/infer", 
                     json={"event": event_data})
```

## ðŸŽ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šè¯­éŸ³å¤‡å¿˜å½•
ç”¨æˆ·è¯´ï¼š"æ˜Žå¤©ä¸‹åˆä¸‰ç‚¹å’Œå¼ æ€»å¼€ä¼šï¼Œè®°å¾—å¸¦ä¸Šé¡¹ç›®æŠ¥å‘Š"
â†’ ç³»ç»Ÿè¯†åˆ«ä¸ºä¼šè®®å®‰æŽ’ï¼Œæé†’å‡†å¤‡ææ–™å’Œç¡®è®¤æ—¶é—´åœ°ç‚¹

### åœºæ™¯2ï¼šå‡ºè¡Œè®¡åˆ’
ç”¨æˆ·è¯´ï¼š"ä¸‹å‘¨åŽ»åŒ—äº¬å‡ºå·®ï¼Œè¦è®¢æœºç¥¨å’Œé…’åº—"
â†’ ç³»ç»Ÿè¯†åˆ«ä¸ºå‡ºè¡Œå®‰æŽ’ï¼Œæé†’æ£€æŸ¥è¯ä»¶ã€æŸ¥çœ‹å¤©æ°”ã€å‡†å¤‡è¡ŒæŽ

### åœºæ™¯3ï¼šè´­ç‰©æ¸…å•
ç”¨æˆ·è¯´ï¼š"å‘¨æœ«åŽ»è¶…å¸‚ä¹°èœï¼Œéœ€è¦ä¹°ç±³ã€æ²¹ã€è”¬èœ"
â†’ ç³»ç»Ÿè¯†åˆ«ä¸ºè´­ç‰©è®¡åˆ’ï¼Œæé†’åˆ¶å®šè¯¦ç»†æ¸…å•å’Œé¢„ç®—

## ðŸ” å…³é”®ç‰¹æ€§

### 1. å‘åŽå…¼å®¹
- æ”¯æŒç®€å•çš„`{"text": "..."}`æ ¼å¼
- çŽ°æœ‰é›†æˆæ— éœ€ä¿®æ”¹

### 2. æ¸è¿›å¢žå¼º
- å¯ä»¥é€æ­¥ä»Žç®€å•æ¨¡å¼å‡çº§åˆ°å®Œæ•´æ¨¡å¼
- äº‹ä»¶æ•°æ®è¶Šä¸°å¯Œï¼Œåˆ†æžç»“æžœè¶Šè¯¦ç»†

### 3. æ™ºèƒ½åˆ†æž
- ä¸ä»…ä»…æ˜¯æ–‡æœ¬åˆ†ç±»ï¼Œè¿˜æä¾›å®žç”¨çš„è¡ŒåŠ¨å»ºè®®
- è€ƒè™‘è¯­éŸ³è´¨é‡ã€è¯´è¯äººä¿¡æ¯ç­‰ä¸Šä¸‹æ–‡

### 4. äººæ€§åŒ–è¾“å‡º
- é¿å…æœºæ¢°åŒ–çš„å›žå¤
- åƒæœ‹å‹ä¸€æ ·çš„è´´å¿ƒå»ºè®®

## ðŸš€ æ‰©å±•æ–¹å‘

1. **æ›´å¤šä»»åŠ¡ç±»åž‹**: å¯ä»¥æ‰©å±•æ”¯æŒæ›´å¤šé¢†åŸŸçš„ä»»åŠ¡
2. **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒè‹±æ–‡ã€ç²¤è¯­ç­‰å…¶ä»–è¯­è¨€
3. **ä¸ªæ€§åŒ–å­¦ä¹ **: åŸºäºŽç”¨æˆ·åŽ†å²è°ƒæ•´å»ºè®®é£Žæ ¼
4. **é›†æˆå¤–éƒ¨æœåŠ¡**: è¿žæŽ¥æ—¥åŽ†ã€åœ°å›¾ã€å¤©æ°”ç­‰API

è¿™å°±æ˜¯PulseWeave API Gatewayçš„å®Œæ•´å·¥ä½œæµç¨‹ï¼å®ƒå°†ç®€å•çš„è¯­éŸ³æ–‡æœ¬è½¬åŒ–ä¸ºæ™ºèƒ½çš„ã€å¯æ‰§è¡Œçš„å»ºè®®ã€‚
